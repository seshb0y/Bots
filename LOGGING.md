# Система логирования Discord бота

## Обзор

Бот использует комплексную систему логирования, которая записывает все события в файлы и выводит их в консоль с цветовой кодировкой.

## Структура логов

### Файлы логов
- **Расположение**: `logs/bot-YYYY-MM-DD.log`
- **Формат**: Ежедневные файлы с датой в названии
- **Автоочистка**: Старые логи (старше 30 дней) автоматически удаляются

### Формат записи
```
[2024-01-15 14:30:25] [INFO] [VOICE] Канал "ПБ" обновлён: было 5, стало 6
[2024-01-15 14:30:26] [ERROR] [ERROR] Не удалось обновить канал 123456789
```

## Уровни логирования

- **DEBUG** (голубой) - Отладочная информация
- **INFO** (зеленый) - Обычные события
- **WARN** (желтый) - Предупреждения
- **ERROR** (красный) - Ошибки

## Компоненты логирования

### Основные функции
- `info(message, data?)` - Информационные сообщения
- `warn(message, data?)` - Предупреждения
- `error(message, data?)` - Ошибки
- `debug(message, data?)` - Отладочная информация

### Специализированные функции
- `logVoiceState(message, data?)` - События голосовых каналов
- `logStats(message, data?)` - Статистика и сбор данных
- `logSyncclan(message, data?)` - Синхронизация клана
- `logPbNotify(message, data?)` - Уведомления о ПБ
- `logQueue(message, data?)` - Очередь на полковые бои
- `logReward(message, data?)` - Выдача наград
- `logCommand(message, data?)` - Выполнение команд
- `logInteraction(message, data?)` - Взаимодействия пользователей

## Примеры использования

### Логирование команд
```typescript
logCommand("Выполняется команда: points", { 
  userId: interaction.user.id, 
  username: interaction.user.tag 
});
```

### Логирование ошибок
```typescript
try {
  // код
} catch (err) {
  error("Ошибка при обработке данных", err);
}
```

### Логирование событий
```typescript
logVoiceState(`Канал "${channel.name}" обновлён: было ${prev}, стало ${realCount}`);
```

## Автоматическая очистка

Система автоматически удаляет логи старше 30 дней при запуске бота. Это помогает экономить место на диске.

## Мониторинг

### Ключевые события для отслеживания:

1. **Ошибки подключения** - `[ERROR] Ошибка при подключении к Discord`
2. **Проблемы с командами** - `[ERROR] Ошибка при обработке взаимодействия`
3. **Проблемы с голосовыми каналами** - `[ERROR] Не удалось обновить канал`
4. **Проблемы с синхронизацией** - `[ERROR] Ошибка при автоматической синхронизации`
5. **Проблемы с наградами** - `[REWARD] Не удалось обработать`

### Аномальные события:

- Множественные ошибки в короткий период
- Неожиданные отключения бота
- Проблемы с доступом к файлам данных
- Ошибки при отправке сообщений в Discord

## Настройка

Логи сохраняются в папке `logs/` в корне проекта. Убедитесь, что у процесса есть права на запись в эту папку.

Для отключения логирования в файл (только консоль), измените функцию `writeToFile` в `src/utils/logger.ts`. 